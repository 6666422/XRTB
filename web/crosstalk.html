<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="Bootstrap static html page for campaign administration."
    name="description">
    <meta content=
    "RTB,OpenRTB,JAVA,Advertising,real-time,campaign,administration" name=
    "keywords">
    <meta content="RTB4FREE" name="author">

    <title>CrossTALK Admin</title>
    <link href=
    "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css"
    rel="stylesheet">
    <link href=
    "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css"
    rel="stylesheet">
    <link href="bootstrap-dialog.css" rel="stylesheet">
    <script src=
    "https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src=
    "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="bootstrap-dialog.js"></script>
    <script src="js/rtb4free.js"></script>
    <style type="text/css">
.bs-example{
        margin: 20px;
    }
    
    .form-signin
{
    max-width: 330px;
    padding: 15px;
    margin: 0 auto;
}
.form-signin .form-signin-heading, .form-signin .checkbox
{
    margin-bottom: 10px;
}
.form-signin .checkbox
{
    font-weight: normal;
}
.form-signin .form-control
{
    position: relative;
    font-size: 16px;
    height: auto;
    padding: 10px;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
}
.form-signin .form-control:focus
{
    z-index: 2;
}
.form-signin input[type="text"]
{
    margin-bottom: -1px;
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
}
.form-signin input[type="password"]
{
    margin-bottom: 10px;
    border-top-left-radius: 0;
    border-top-right-radius: 0;
}
.account-wall
{
    margin-top: 20px;
    padding: 40px 0px 20px 0px;
    background-color: #f7f7f7;
    -moz-box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.3);
    -webkit-box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.3);
    box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.3);
}
.login-title
{
    color: #555;
    font-size: 18px;
    font-weight: 400;
    display: block;
}
.profile-img
{
    width: 96px;
    height: 96px;
    margin: 0 auto 10px;
    display: block;
    -moz-border-radius: 50%;
    -webkit-border-radius: 50%;
    border-radius: 50%;
}
.need-help
{
    margin-top: 10px;
}
.new-account
{
    display: block;
    margin-top: 10px;
}

    </style>
</head>

<body>


 <div class="container">
 
    <div class="row" id="login">
        <div class="col-sm-6 col-md-4 col-md-offset-4">
            <h1 class="text-center login-title">Sign in to CrossTALK</h1>
            <div >
                <form class="form">
                <input type="text" class="form-control" placeholder="Email" required autofocus id="username" value='demo'>
                <input type="password" class="form-control" placeholder="Password" required id="password" value='dordemonobigdeal'>
                <input type="button" class="btn btn-primary btnSeccion" onclick="doFormLogin();" value="Sign In"></button>
                </form>
            </div>

<script type="text/javascript">

function toggle(elementId) {
	var ele = document.getElementById(elementId);
	if(ele.style.display == "block") {
    		ele.style.display = "none";
  	}
	else {
		ele.style.display = "block";
	}
} 

</script>

        </div>
    </div>
</div>

 <div class="bs-example" style="display:none" id="bs-example">
           
  <div class="panel panel-primary">
   <div class="panel-heading">
      <h3 class="panel-title">CrossTALK Administration Page</h3>
   </div>
   <div class="panel-body">

        
        <p>This page is used to manage CrossTALK-RTB</p>

</div>

        <div class="tab-content" id="myTabContent">
              
            <div class="tab-pane fade" id="logs">
            
            
            <div class="panel panel-success">
  				 <div class="panel-heading">
      				<h3 class="panel-title">RTB System Logs</h3>
   				</div>
   				<div class="panel-body">
				 <table id="rtblogger" border="0" cellpadding="0" cellspacing="0" width="100%" class="scrollTable"/>
   					 <thead>
<tr>
<th>Date</th>
<th>Sev</th>
<th>From</th>
<th>Source</th>
<th>Message</th>
</tr>
</thead>
<tbody class="scrollContent">
</tbody>
</table>   
 
 				</div>
			</div>

            </div>
            
              <div class="tab-pane fade in active" id="status">
            <div class="panel panel-success">
  				 <div class="panel-heading">
      				<h3 class="panel-title">Bidders</h3>
   				</div>
   				<div class="panel-body">
   				
   				<div id='bidders'></div>
   				
   			  </div>
   			</div>

            <div class="tab-pane fade in active" id="status">
            <div class="panel panel-success">
  				 <div class="panel-heading">
      				<h3 class="panel-title">Campaigns</h3>
   				</div>
   				<div class="panel-body">
   				
   <table id="campaigns">
   <tr>
   <th>Campaign ID</th>
   <th>Start</th>
   <th>Stop</id>
   <th>Ad Domain</th>
   <th>Budget</th>
   <th>Cost</th>
    
   </table>
 
 				</div>
			</div>

			 <div class="panel panel-success">
  				 <div class="panel-heading">
      				<h3 class="panel-title">Commands</h3>
   				</div>
   				<div class="panel-body">
  				<button type="button" class="btn btn-danger" id='sweep-crosstalk' onclick='doSweep()'>Sweep Campaigns</button>
                <button type="button" class="btn btn-success" id='forcerun-crosstalk' onclick='forceRun()'>Run CrossTALK</button>
                <button type="button" class="btn btn-warning" id='changelog-crosstalk' onclick='doChangeLog()'>Change Log Level</button>
                <button type="button" class="btn btn-success" id='changenobidreason-crosstalk' onclick='doViewCampaign()'>View Campaign</button>
                <button type="button" class="btn btn-danger" id='reload-crosstalkr' onclick='doReloadCampaigns()'>Reload Campaigns</button>  
 
 				</div>
			</div>
			
			<div class="panel panel-success">
  				 <div class="panel-heading">
      				<h3 class="panel-title">Logs</h3>
   				</div>
   				<div class="panel-body">		
   					 <table id="logger" border="0" cellpadding="0" cellspacing="0" width="100%" class="scrollTable"/>
   					 <thead>
<tr>
<th>Date</th>
<th>Sev</th>
<th>From</th>
<th>Source</th>
<th>Message</th>
</tr>
</thead>
<tbody class="scrollContent">
</tbody>
</table>
 
 				</div>
			</div>

            </div>
            
                     
        </div>
                      
    </div>
    
          <footer>
        <p>&copy; Ben M. Faul, Peter Loh, RTB4FREE.ORG 2015<br/>Email: Ben.Faul@gmail.com</p>
      </footer>   
      
    </div>
    </div>
</body>
<script>

function revert() {
	doFormLogin();
}

function doFormLogin() {
	userName = document.getElementById("username").value;
	var password = document.getElementById("password").value;
	console.log("U="+userName+", P="+password);
	
	ele = document.getElementById("bs-example");
	ele.style.display = "block";
	
	ele = document.getElementById("login");
	ele.style.display = "none";
	
	cmd = {
		op: 'campaigns'
	};
	
	$.ajax({
    	type: "PUT",
    	url: "http://localhost:7379/PUBLISH/elbritcmds",
   		contentType: "application/json",
    	data: JSON.stringify(cmd)
    }); 
}

function doReloadCampaigns() {
	cmd = {
		op: 'reload'
	};
	
	$.ajax({
    	type: "PUT",
    	url: "http://localhost:7379/PUBLISH/elbritcmds",
   		contentType: "application/json",
    	data: JSON.stringify(cmd)
    });
}

function doSweep() {
	cmd = {
		op: 'sweep'
	};
	
	$.ajax({
    	type: "PUT",
    	url: "http://localhost:7379/PUBLISH/elbritcmds",
   		contentType: "application/json",
    	data: JSON.stringify(cmd)
    });
}

function forceRun() {
	cmd = {
		op: 'forcerun'
	};
	
	$.ajax({
    	type: "PUT",
    	url: "http://localhost:7379/PUBLISH/elbritcmds",
   		contentType: "application/json",
    	data: JSON.stringify(cmd)
    });
}

function doViewCampaign() {
	cmd = {
		op: 'viewcampaign'
	};
	
	$.ajax({
    	type: "PUT",
    	url: "http://localhost:7379/PUBLISH/elbritcmds",
   		contentType: "application/json",
    	data: JSON.stringify(cmd)
    });
}

function setLogLevel(value) {
	cmd = {
		op: 'setloglevel',
		value:  value
	};
	
	$.ajax({
    	type: "PUT",
    	url: "http://localhost:7379/PUBLISH/elbritcmds",
   		contentType: "application/json",
    	data: JSON.stringify(cmd)
    });
}


   function doChangeLog() {
  	 	BootstrapDialog.show({
   			type: BootstrapDialog.TYPE_WARNING,
   			title: 'WARNING',
            message: function(dialogItself) {
				var $form = $('<form></form>');
        		//var $titleDrop = $('<input type="text" id="newlevel" />');
        		
        		var $titleDrop = "<select id='newlevel'>" +
  									"<option value='-5'>-5</option>" +
  									"<option value='-4'>-4</option>" +
  									"<option value='-3'>-3</option>" +
  									"<option value='-2'>-2</option>" +
  									"<option value='-1'>-1</option>" +
  									"<option value='1'>1</option>" +
  									"<option value='2'>2</option>" +
  									"<option value='3' selected>3</option>" +
  									"<option value='4'>4</option>" +
  								    "<option value='5'>5</option>" +
									"</select>";
        		
        		dialogItself.setData('field-title-drop', $titleDrop);   // Put it in dialog data's container then you can get it easier by using dialog.getData() later.
        		$form.append('You are about to change log levels<br/><label>New log level (-5 to 5)&nbsp; </label>').append($titleDrop);

        		return $form;
            },
          //  message: 'You are about to change the logging level of the selected bidders!',
            buttons: [
            {
                label: 'Proceed?',
                cssClass: 'btn-warning',
                action: function(dialogRef) {
   					dialogRef.enableButtons(false);
                    dialogRef.setClosable(false)
                    obj = document.getElementById("newlevel");
                    var value = obj.value
                	setLogLevel(value);
                    dialogRef.close();
                }
            }, {
                label: 'Close',
                action: function(dialogItself){
                    dialogItself.close();
                }
            }]
        });
   }

function callback(json) {
	var obj = json.SUBSCRIBE;
	obj = obj[2];
	var stub = JSON.parse(obj);
	stub = stub.message;
	stub = JSON.parse(stub);
	if (typeof stub.campaigns !== 'undefined') {
		campaigns = stub.campaigns;
		campDyno.clear();
		for (var i=0;i<campaigns.length;i++) {
			var c = campaigns[i];
			campDyno.add([c.id,c.start,c.stop,c.adomain,c.budget,c.cost]);
		}
	}
	if (typeof stub.message !== 'undefined') {
		if (stub.error == false)
			doModal(BootstrapDialog.TYPE_INFO,"Info",stub.message);
		else
			doModal(BootstrapDialog.TYPE_DANGER,"Error",stub.message);
	}
	if (typeof stub.rtbs !== 'undefined') {
		document.getElementById('bidders').innerHTML = JSON.stringify(stub.rtbs,null,2);
	}
}

 campCells = []
    campCells.push("<input type='text' id='SUB_ID' size='10' value='' placeholder='' />");
    campCells.push("<input type='text' id='SUB_ID' size='20' value='' placeholder='' />");
    campCells.push("<input type='text' id='SUB_ID' size='20' value='' placeholder='' />");
    campCells.push("<input type='text' id='SUB_ID' size='20' value='' placeholder='' />");
    campCells.push("<input type='text' id='SUB_ID' size='20' value='' placeholder='' />");
    campCells.push("<input type='text' id='SUB_ID' size='20' value='' placeholder='' />");
    campDyno = new DynamicTable("campaigns",campCells);

    redis = new RedisCallback("elbrit","localhost:7379",callback);
    
    logger = new Logger('logger','elbrit',"localhost:7379");
    
    rtblogger = new Logger('logger','log',"localhost:7379");
    
    
 </script>

</html>