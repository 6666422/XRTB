<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="Bootstrap static html page for campaign administration."
    name="description">
    <meta content=
    "RTB,OpenRTB,JAVA,Advertising,real-time,campaign,administration" name=
    "keywords">
    <meta content="RTB4FREE" name="author">

    <title>RTB4FREE Admin</title>
    <link href=
    "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css"
    rel="stylesheet">
    <link href=
    "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css"
    rel="stylesheet">
    <script src=
    "https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src=
    "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <style type="text/css">
.bs-example{
        margin: 20px;
    }
    </style>
</head>

<body>
    <div class="bs-example">
        <h2>RTB4FREE Campaign Administrator Page</h2>

        <p>This page is used to manage sample campaigns. You need a login to
        actually manage your campaigns. If you already have made a login, type
        the name in here and push the 'Login' button.</p>

        <p>If you don't have a login, simply type the login name you would like
        and push 'Login' and a login will be made for you.</p>

        <p>Be aware that logins expire after 30 days, and your login (and
        campaigns) are deleted unless you login at least once within the 30 day
        period.</p><input id="p_username" placeholder="User name" size="40"
        type="text" value=""> <input id="p_login" onclick="doLogin()" type=
        "button" value="Login"> <script>

        function doLogin() {
        clearFields();
        
        name = document.getElementById('p_username').value;
        if (name == "")
        	return;
        	
        data = {
        command: 'login',
        username: name
        };

        $.ajax({
         type: 'POST',
         url:'ajax',
         data: JSON.stringify(data),
         dataType: 'json',
         success: function(data, textStatus, request){
           if (request.status == 204) {
            text = "";
           } else {
            text = request.responseText;
            data = JSON.parse(text);
            
            camps = data.campaigns;
            message = data.message;
            text = JSON.stringify(data,null,2);
            
         
           }
         //  console.log("data = " + JSON.stringify(camps,null,2));
           if (message != null && message != "")
                alert(message);
               
           for (i=0;i<camps.length;i++) {
                campaign = camps[i];
                dyno("new",campaign.adId);
           }

         },
         error: function (request, textStatus, errorThrown) {
           alert("Error: " + request.responseText);
         }});
        }


        function clearAttributeFields() {
        	var table = document.getElementById("addinput");
			while(table.rows.length>1) {
               table.deleteRow(1);
            }
            rowCount = 0;
        }
        
        function clearTemplateFields() {
        	var table = document.getElementById("addtemplate");
			while(table.rows.length>2) {
               table.deleteRow(2);
            }
        }
        
        function clearFields() {
        	clearAttributeFields();
        	clearTemplateFields();
        }

        function deleteCampaign(what,name) {
           var table = document.getElementById("addinput");
           for(var i = 0; i < table.rows.length; i++) {
                row = table.rows[i];
                id = row.getAttribute("id");
                if (id == "row" + what)  {;


        ///////////////////
               data = {
                    command: 'deletecampaign',
                username: document.getElementById('p_username').value,
                campaign: name
            };
        $.ajax({
         type: 'POST',
         url:'ajax',
         data: JSON.stringify(data),
         dataType: 'json',
         success: function(data, textStatus, request){
           if (request.status == 204) {
            text = "";
           } else {
            text = request.responseText;
            data = JSON.parse(text);
            if (data.campaigns != null) {
                camps = data.campaigns;
            }
            message = data.message;
            text = JSON.stringify(data,null,2);
            console.log("-----------------");
            console.log(text);
           }
           if (message != null && message != "")
                alert(message);
               
                    dyno(what);
                    return;

         },
         error: function (request, textStatus, errorThrown) {
           alert("Error: " + request.responseText);
         }});
        //////////////////





                }
             }
        }


        rowCount = 0;
         function dyno(what, a, b) {
            var table = document.getElementById("addinput");
            if (what === 'new') {
                rowCount++;
                row = table.insertRow(-1);
                row.setAttribute("id", "row" + rowCount);
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                
                if (a === undefined) 
                    value ="?"
                else 
                    value = a;
                cell1.innerHTML = "<input type='button' value='" + value + "' onclick=\"processCampaign('" + value + "');\"  class='primary-btn col-xs-11 text-left' style=\"width:280px\">";     
                cell2.innerHTML = "<a href=\"javascript:deleteCampaign('" + rowCount + "','"+value+"');\">Del<\/a>";
            } else {
             for(var i = 0; i < table.rows.length; i++) {
                row = table.rows[i];
                id = row.getAttribute("id");
                if (id == "row" + what)  {
                    table.deleteRow(i);
                    return;
                }
             }
         
             }     
         };
         
         function doDyno() {
            var newName = document.getElementById("ad_domain").value;

            if (newName == '') {
                alert("Error: Can't have a blank ad domain");
                return;
            }
            
            ///////////////////////////////////////////////////
               data = {
                    command: 'stub',
                username: document.getElementById('p_username').value,
                campaign: newName
            };

        $.ajax({
         type: 'POST',
         url:'ajax',
         data: JSON.stringify(data),
         dataType: 'json',
         success: function(data, textStatus, request){
           if (request.status == 204) {
            text = "";
           } else {
            text = request.responseText;
            data = JSON.parse(text);
            
            camp = data.campaign;
            camps.push(camp);
            message = data.message;
            text = JSON.stringify(data,null,2);
         
           }
         //  console.log("data = " + JSON.stringify(camps,null,2));
           if (message != null && message != "")
                alert(message);
               
            dyno("new",camp.adId);
            document.getElementById("ad_domain").value = "";
           

         },
         error: function (request, textStatus, errorThrown) {
           alert("Error: " + request.responseText);
         }});
            
            ////////////////////////////////////////////////////
            
            
         }

        //////////////////////////////////
        
        function doDynoTemplate() {
         	var a = document.getElementById("p_new_exchange").value;
         	var b = document.getElementById("p_new_template").value;
         	if (a == '') {
         		alert("Error: Can't have a blank exchange");
         		return;
         	}
         	if (b == '') {
         		alert("Error: Can't have a blank template");
         		return;
         	}
         	dynoTemplate("new",a,b);
         	document.getElementById("p_new_exchange").value = "";
         	document.getElementById("p_new_template").value = "";
         }
        
         function dynoTemplate(what, a, b) {
            var table = document.getElementById("addtemplate");
            if (what === 'new') {
                var rc = table.rows.length + 1;
                row = table.insertRow(-1);
                row.setAttribute("id", "row" + rc);
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                
                if (a === undefined) 
                    name ="?"
                else 
                    name = a;
                    
                if (b === undefined) 
                    value ="?"
                else 
                    value = b;

                cell1.innerHTML = '<input type="text" id="p_new" size="20" name="p_new" value="' + name + '" placeholder="exchange" />';
				cell2.innerHTML = '<input type="text" id="p_new" size="80" name="'+name+'" value=' + value  + ' placeholder="template" />';
				
         		cell3.innerHTML = '<a href="javascript:dynoTemplate(' + rc + ');">Del</a>';
            } else {
             for(var i = 0; i < table.rows.length; i++) {
                row = table.rows[i];
                id = row.getAttribute("id");
                if (id == "row" + what)  {
                    table.deleteRow(i);
                    return;
                }
             }
         
             }     
         };

        </script>

        <div id="list-block">
            <hr>
            <input id="ad_domain" placeholder="ad id" size="40" type="text"
            value=""> <input onclick="doDyno();" type='button' value='+'><br>

            <table id="addinput">
                <tr>
                    <th>Select Campaign to Edit</th>
                </tr>

                <tr id="row0">
                    <td></td>

                    <td></td>
                </tr>
            </table>
        </div>
        <hr>

        <ul class="nav nav-tabs" id="myTab">
            <li class="active">
                <a data-toggle="tab" href="#attributes">Attributes</a>
            </li>

            <li>
                <a data-toggle="tab" href="#templates">Templates</a>
            </li>

            <li>
                <a data-toggle="tab" href="#creatives">Creatives</a>
            </li>

            <li>
                <a data-toggle="tab" href="#constraints">Constraints</a>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade in active" id="attributes">
            
<form role="form" method="get" action="#">
	<div class="form-group">
		<div class="col-lg-2">
			<label for="name">Ad Domain</label>
			<input type="text" class="form-control" id="adomain" placeholder="Enter ad domain" />
		</div>
	</div>
	<div class="form-group">
		<div class="col-lg-2">
			<label for="price">Price</label>
			<input type="text" class="form-control" id="price" placeholder="Price" />
		</div>
	</div>
	<div class="form-group">
		<div class="col-lg-2">
			<label for="adid">Ad Id</label>
			<input type="text" class="form-control" id="adid" placeholder="Ad ID" />
		</div>
	</div>
	<div class="form-group">
		<div class="col-lg-2">
			<label for="startdate">Start Date</label>
			<input type="text" class="form-control" id="startdate" placeholder="Start date" />
		</div>
	</div>
	<div class="form-group">
		<div class="col-lg-2">
			<label for="enddate">End Date</label>
			<input type="text" class="form-control" id="enddate" placeholder="End date" />
		</div>
	</div>

<div class="checkbox">
	<label><input type="checkbox" /> Check me out</label>
</div>
<button type="submit" class="btn btn-default">Submit</button>
</form>
            </div>

            <div class="tab-pane fade" id="templates">
				<div class="form-group">
					<div class="col-lg-2">
						<label for="default">Default</label>
						<input type="text" class="form-control" id="default" placeholder="Default template" />
					</div>

				    <table id="addtemplate">
         				<th>Exchange</th>
         				<th>Template</th>
         					<tr id="row0">
            				<td>
              			 		<input type="text" id="p_new_exchange" size="20" name="p_new_x" value="" placeholder="exchange name" />
            				</td>
            				<td>
               					<input type="text" id="p_new_template" size="80" name="p_new" value="" placeholder="template is here" />
           			 		</td>
            				<td><a href="javascript:doDynoTemplate();">Add</a></td>
         				</tr>
					 </table>
				</div>
           	</div>

            <div class="tab-pane fade" id="creatives">
                <p>We will edit the creatives here</p>

                <p></p>
            </div>

            <div class="tab-pane fade" id="constraints">
                <p>We will edit the constraints here</p>

                <p></p>
            </div>
        </div>
    </div><script>

    function processCampaign(which) {
    for(i=0;i<camps.length;i++) {
        c = camps[i];
        if (c.adId == which) {
            console.log("@@@@@@@@@@@");
            document.getElementById("adomain").value = c.adomain;
            document.getElementById("price").value = c.price;
            document.getElementById("adid").value = c.adId;
            document.getElementById("startdate").value = c.date[0];
            document.getElementById("enddate").value = c.date[1];
            
            document.getElementById("default").value = c.template.default;
            
            var exchange = c.template.exchange;
            for (var p in exchange) {
    			if( exchange.hasOwnProperty(p) ) {
    				dynoTemplate("new",p,exchange[p]);
    			} 
  			}         
            
            
        }
    }
    }

    </script>
</body>
</html>                 		