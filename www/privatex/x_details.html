<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="Details how to build and operate the RTB bidding engine."
    name="description">
    <meta content="RTB,OpenRTB,JAVA,Advertising,real-time" name="keywords">
    <meta content="RTB4FREE" name="author">

    <title>RTB Private Exchange Details</title><!-- Latest compiled and minified CSS -->
    <link href=
    "http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel=
    "stylesheet"><!-- jQuery library -->

    <script src=
    "https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script><!-- Latest compiled JavaScript -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5532985-4', 'auto');
  ga('send', 'pageview');

</script>
</head>

<body>
    <nav class="navbar navbar-fixed-top navbar-inverse">
        <div class="container">
            <div class="navbar-header">
                <button class="navbar-toggle collapsed" data-target="#navbar"
                data-toggle="collapse" type="button"><span class=
                "sr-only">Toggle navigation</span> <span class=
                "icon-bar"></span> <span class="icon-bar"></span> <span class=
                "icon-bar"></span></button> <a class="navbar-brand" href=
                "#">RTB For Free!</a>
            </div>

            <div class="collapse navbar-collapse" id="navbar">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="x_index.html">Home</a>
                    </li>

                    <li>
                        <a href="x_about.html">About</a>
                    </li>

                    <li>
                        <a href="x_contact.html">Contact</a>
                    </li>
                </ul>
            </div><!-- /.nav-collapse -->
        </div><!-- /.container -->
    </nav><!-- /.navbar -->
    <br>
    <br>
    <br>
    <br>

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>RTB Private Exchange</h1><i>(NOTE: THIS IS A WORK IN
                PROGRESS)</i><br>

                <p>A RTB Private Exchange written in Java
                1.8</p>The Private Exchange project contains 3 major components:

                <ul>
                    <li>RTB private Exchange</li>

                    <li>Sample web page demonstrating the concepts</li>

                    <li>Administration system for web-page campaign definition</li>
                </ul>

                <p>This project is for those fairly familiar with RTB. With a
                basic understanding of RTB, this project will get you up and
                running with a stand-alone RTB based private exchange. Though not
                intended to be a production auction platform, the concepts this exchange
                uses is similar to those encountered in a production system.</p>
                <p>This system uses a simple shared JAVA HashMap objects as the
                database of campaigns to associate with advertisements, which is
                based on the the Redisson system. A commercial auction system would
                of course us a real DBMS for this.</p>
                <p>This section of the RTB4FREE web site steps you through all
                the steps required in setting up a campaign on a web page, and then how to point
                your own mobile browser to the sample web page to fire the ad request to the
                Private Exchange, send the bid request to the RTB4FREE bidder, then receive the
                advertisement back and displayed in your broswer.</p>
                <p>The sample advertisement will use your GEO location to send you
                an appropriate bid</p>
                <p>

                <ul>
                    <li>
                        <a href="#BUILD">Building the System</a>
                    </li>

                    <li>
                        <a href="#CONFIGURATION">Configuring and Running the
                        System</a>
                    </li>

                    <li>
                        <a href="#RUNNING">Running System</a>
                    </li>

                    <li>
                        <a href="#ANATOMY-BANNER">Anatomy of a Banner Advertisement</a>
                    </li>
					 <li>
                        <a href="#ANATOMY-VIDEO">Anatomy of a Video Advertisement</a>
                    </li>
                    <li>
                        <a href="#THEORY">Theory of Operation</a>
                    </li>

                    <li>
                        <a href="#REDIS">REDIS Commands</a>
                    </li>

                    <li>
                        <a href="#DEPENDENCIES">Dependencies</a>
                    </li>
                </ul>

                <nav>
                    <ul class="pager">
                        <li>
                            <a href="arch/RTB_architecture_mod3.html" target=
                            "_blank">Architecture Slides</a>
                        </li>

                        <li>
                            <a href="javadoc/index.html" target=
                            "_blank">Javadoc Pages</a>
                        </li>

                        <li>
                            <a href="html/index.html" target="_blank">Junit
                            Reports</a>
                        </li>
                    </ul>
                </nav>
                <hr>
                <a id="BUILD" name="BUILD"></a>

                <h1>BUILDING THE SYSTEM</h1>

                <p>You will need ANT, JAVA 1.8, and REDIS installed to build
                the system. The dependent libraries required are already placed
                in the ./libs directory</p>If you use Eclipse or some other
                IDE, make your project includes the ./libs directory.
                <p>

                <p>Note, there is a stub .gitignore file included, (named gitignore, rename it to .gitignore).</p>

                <p>Now use ant to build the system:</p>$ant

                <p>----&gt; Will create ./libs/privatex.jar -- Which is the jar
                file of the private excgabfe project.</p>

                <p>$ant javadoc</p>

                <p>----&gt; Will create <a href="javadoc/index.html" target=
                "_blank">javadoc</a> documents in the ./javadoc directory.</p>

                <p>$ant junitreport</p>

                <p>----&gt; Will run the <a href="html/index.html" target=
                "_blank">JUNIT</a> test cases and output the reports in the
                ./reports directory</p><a id="CONFIGURATION" name=
                "CONFIGURATION"></a>

                <h1>Running the Private Exchange</h1>

                <p>In order to run the private exchange you first have to load an
                initial database of campaigns into Redis, then construct a configuration
                file for use on startup, and then you can actually start the
                private exchange. The steps below will accomplish these tasks</p>

                <h2>Creating Initial Database as JSON File</h2>

                <p>Before you can use the private exchange, the RTB4FREE Private
                Exchange has to be configured. The first thing to configure is the web-page
                campaign database, which is actually a JAVA ConcurrentHashMap, that is
                shared across all the private exchange instance (regardless of what host they are
                on) as a Redisson object. Redisson provides the shared context
                among all the private exchange instances. Redisson uses the REDIS key/value store.
                By using Redisson, RTB4FREE can share the User/Web-Campaign
                database simply by instantiating the Map and using it as
                normal. Private Exchange Instance A makes a change, Private Exchange Instance B can immediately see
                the changes</p>

                <p>There are multiple records of the User object in the Map.
                The User object is simple object with the name, a time stamp,
                and a List of Campaign records. The initial Redisson database
                is loaded from file using the DbTools program. A sample first
                database is provided as ./database.json Simply run the DBTools
                program and this initial database will be stored in Redis for
                you. From there you can easily run the rest of the system. The
                database.hson file has one user "ben", and "ben" has 1
                campaign, which matches the web campaign used as the sample ad page
                for the demonstration of this system. Each web page has a user/web-campaign record. 
                The contents of ./web-campaigns.json can be viewed
                <a href="javascript:toggle('databaseJSON');" id=
                "display1">here.</a></p>


                <div onclick="javascript:toggle('databaseJSON');">
                    <div id="databaseJSON" style=
                    "display:none; border-width:2px; border-style:solid">
<pre>
<code>
{
    "publishers": {
        "111-222-33-444-555": {
            "name": "Really Big Corp.",
            "address": "the-address",
            "telephoneNumber": "tel-number",
            "id": "publisher-id",
            "domain":"junk1.com",
            "campaigns": {
                "banner-campaign": {
                    "price": 10,
                    "served": 0,
                    "requested": 0,
                    "page": "http://www.rtb4free/sample.html",
                    "attributes": [
                        "var Impression = Java.type('com.xrtb.privatex.bidrequest.Impression');",
                        "im = new Impression().doBanner();",
                        "im.id = request.id;",
                        "im.instl = 0;",
                        "im.banner.setHeight(50);",
                        "im.banner.setWidth(320);",
                        "im.banner.setPos(0);",
                        "request.imp.add(im);",
                        "request.device.ua =  cmd.ua;",
                        "request.device.geo.lat = cmd.lat;",
                        "request.device.geo.lon = cmd.lon;",
                        "request.site.cat.add('IAB1');",
                        "request.site.cat.add('IAB2');",
                        "request.site.ext.rtb4free.platform=cmd.platform;",
                        "request.site.ext.rtb4free.connectionType=cmd.connectionType;",
                        "request.site.ext.rtb4free.maxDownLink=cmd.maxDownLink;"
                    ]
                },
                "video-campaign": {
                    "price": 12,
                    "served": 0,
                    "requested": 0,
                    "page": "http://www.rtb4free/video-sample.html",
                    "attributes": [
                        "var Impression = Java.type('com.xrtb.privatex.bidrequest.Impression');",
                        "im = new Impression().doVideo();",
                        "im.id = request.id;",
                        "im.instl = 0;",
                        "im.video.setWidth(400);",
                        "im.video.setHeight(200);",
                        "im.video.setLinearity(1);",
                        "im.video.setMinduration(5);",
                        "im.video.setMaxduration(30);",
                        "im.video.setPos(0);",
                        "im.video.addMime('video/x-flv');",
                        "im.video.addMime('application/x-shockwave-flash');",
                        "im.video.setProtocol(2);",
                        "request.imp.add(im);",
                        "request.device.ua =  cmd.ua;",
                        "request.device.geo.lat = cmd.lat;",
                        "request.device.geo.lon = cmd.lon;",
                        "request.site.cat.add('IAB1');",
                        "request.site.cat.add('IAB2');",
                        "request.site.ext.rtb4free.platform=cmd.platform;",
                        "request.site.ext.rtb4free.connectionType=cmd.connectionType;",
                        "request.site.ext.rtb4free.maxDownLink=cmd.maxDownLink;"
                    ]
                }
                
            }
        }
    },
    "subscribers": [
        {
            "name": "the-name",
            "address": "the-address",
            "telephoneNumber": "tel-number",
            "accountNumber": "account-number",
            "url": "http://localhost:8080/rtb/bids/nexage",
            "maxConnections": 100,
            "maxRate": 1000
        }
    ]
}
</code>
</pre>         
                </div>
                </div>
                <p>

                <h2>Load Initial Database File into Redis(son)</h2>

                <p>With the initial database.json ready, we will now load the
                database.json into Redisson. Simoly run the following ant
                command:</p>
                <pre>
    $ant load-database
</pre>This will load database.json from the current directory into the Redis
system running on a host. To change the parameters of DbTools, look at the
JAVADOC for <a href="privatex/javadoc/tools/DbTools.html" style="font-style: italic"
                target="_blank">com.xrtb.privatex.cfg.Database.java</a> for details on how to
                use the DbTools program.
                <p>

                <p>The database in Redis is where all the User/Web-Campaign records
                are stored, but, then to run these campaigns, you must tell the
                Private Exchanges to pull these web campaigns into their local memory (using
                a Redis command). The database in Redis is the static location
                for the Users and their Campaigns. To 'run' a campaign' you
                load it into the bidders local memory. All the bidders have a
                ConcurrentHashMap that comprises this database, and it is
                shared across all the bidders.</p>

                <p>In a commercial setting, you would likely replace this
                shared hashmap/Database part of Private Exchange with your own database management
                system.</p>
                There is a sample initialization file called
                "./config.json' you can use to get started. The file
                describes the operational parameters of the private exchange. If
                you want to see the sample configuration, click here: <a href=
                "javascript:toggle('toggleText');" id=
                "displayText">./config.json</a></p>

                <div onclick="javascript:toggle('toggleText');">
                    <div id="toggleText" style=
                    "display:none; border-width:2px; border-style:solid">
<pre>
<code>
{
    "instance": "this-systems-instance-name-here",
    "port": 9090,
    "app": {
        "connections": 100,
        "ttl": 300,
        "verbosity": {
            "level": -5,
            "nobidReason": true
        },
        "redis": {
            "host": "localhost",
            "logger": "xlog",
            "port": 6379
        },
        "campaigns": [
            {
                "accountNumber": "111-222-333",
                "campaign": "TheSampleDemoCampaign"
            }
        ]
    },
    "web": [
        {
            "context": ["/h*"],
            "base": ".",
            "className": "HelloHandler"
        },
        {
            "context": ["/b*"],
            "base": ".",
            "className": "ByeHandler"
        }
    ]
}
</code>
</pre>
</div>
                </div>
                <p>The <i>publishers</i> object is an array of publishers (entities offering for sale space on a web page).</p>
                <p>The <i>subscribers</i> object is an array describing one or more RTB bidding engines that can connect to the private
                exchange and participate in auctions.</p>

                <h2>Configuring the Private Exchange</h2>
                <p>In order to run the private exchange, you will need to load a web-campaign
                into the private exchange's memory and setup some operational parameters.
                These parameters are stored in a JSON file the private exchange uses when
                it starts. The file is located here
  				
  				<a href=
                "javascript:toggle('toggleInstance');" id=
                "displayText">./config.json</a></p>

                <div onclick="javascript:toggle('toggleInstance');">
                    <div id="toggleInstance" style=
                    "display:none; border-width:2px; border-style:solid">
 <pre>
 <code>               
{
    "instance": "this-systems-instance-name-here",
    "port": 9090,
    "app": {
        "connections": 100,
        "ttl": 300,
        "verbosity": {
            "level": 2,
            "nobid-reason": true
        },
        "redis": {
            "host": "localhost",
            "logger": "xlog",
            "port": 6379
        },
        "campaigns": [
            {
                "accountNumber": "111-222-333",
                "campaign": "TheSampleDemoCampaign"
            }
        ]
    }
}
</code>
</pre>      
</div>      
</div>     
                <a id="RUNNING" name="RUNNING"></a>
                <h1>RUNNING THE PRIVATE EXCHANGE</h1>
                <p>Now that you have the Private Exchange configured and the database loaded into redisson you need to start the private exchange.
                Issue the following command:</p>
                <pre>
                      $ant privatex
                </pre>
                <p>The output of the ant command will show some initialization. To see what the startup looks like click 

				<a href=
                "javascript:toggle('toggleSTDOUT');" id=
                "displayText">here.</a></p>

                <div onclick="javascript:toggle('toggleSTDOUT');">
                    <div id="toggleSTDOUT" style=
                    "display:none; border-width:2px; border-style:solid">
               
<pre>
<code>                
Picked up JAVA_TOOL_OPTIONS: -javaagent:/usr/share/java/jayatanaag.jar 
Subscribers:
Subscribers:
[
  {
    "url": "http://localhost:8080/rtb/bids/nexage",
    "accountNumber": "account-number",
    "name": "the-name",
    "address": "the-address",
    "telephoneNumber": "tel-number",
    "maxConnections": 100,
    "maxRate": 1000,
    "sentOk": 0,
    "errored": 0,
    "bid": 0,
    "noBid": 0,
    "winners": [],
    "requests": []
  }
]
-------------
Publishers:
Publishers:
{
  "111-222-333-444-555": {
    "name": "Really Big Corp.",
    "address": "the-address",
    "telephoneNumber": "tel-number",
    "id": "publisher-id",
    "domain": "junk1.com",
    "campaigns": {
      "banner-campaign": {
        "price": 10.0,
        "served": 0,
        "requested": 0,
        "page": "http://www.rtb4free/sample.html",
        "attributes": [
          "var Impression = Java.type('com.xrtb.privatex.bidrequest.Impression');",
          "im = new Impression().doBanner();",
          "im.id = request.id;",
          "im.instl = 0;",
          "im.banner.setHeight(50);",
          "im.banner.setWidth(320);",
          "im.banner.setPos(0);",
          "request.imp.add(im);",
          "request.device.ua =  cmd.ua;",
          "request.device.geo.lat = cmd.lat;",
          "request.device.geo.lon = cmd.lon;",
          "request.site.cat.add('IAB1');",
          "request.site.cat.add('IAB2');",
          "request.site.ext.rtb4free.platform=cmd.platform;",
          "request.site.ext.rtb4free.connectionType=cmd.connectionType;",
          "request.site.ext.rtb4free.maxDownLink=cmd.maxDownLink;"
        ]
      },
      "video-campaign": {
        "price": 12.0,
        "served": 0,
        "requested": 0,
        "page": "http://www.rtb4free/video-sample.html",
        "attributes": [
          "var Impression = Java.type('com.xrtb.privatex.bidrequest.Impression');",
          "im = new Impression().doVideo();",
          "im.id = request.id;",
          "im.instl = 0;",
          "im.video.setWidth(400);",
          "im.video.setHeight(200);",
          "im.video.setLinearity(1);",
          "im.video.setMinduration(5);",
          "im.video.setMaxduration(30);",
          "im.video.setPos(0);",
          "im.video.addMime('video/x-flv');",
          "im.video.addMime('application/x-shockwave-flash');",
          "im.video.setProtocol(2);",
          "request.imp.add(im);",
          "request.device.ua =  cmd.ua;",
          "request.device.geo.lat = cmd.lat;",
          "request.device.geo.lon = cmd.lon;",
          "request.site.cat.add('IAB1');",
          "request.site.cat.add('IAB2');",
          "request.site.ext.rtb4free.platform=cmd.platform;",
          "request.site.ext.rtb4free.connectionType=cmd.connectionType;",
          "request.site.ext.rtb4free.maxDownLink=cmd.maxDownLink;"
        ]
      }
    }
  }
}
Compiling Nashorn for Really Big Corp.
... banner-campaign ... done.
... video-campaign ... done.
Compilation complete
[2015-07-29 10:11:28.407] - 2 - this-systems-instance-name-here - Exchange/run - Starting on port 8080
[2015-07-29 10:11:28.463] - 0 - this-systems-instance-name-here - initialization - System start on port: 8080
[Thread-3] INFO org.eclipse.jetty.server.Server - jetty-8.1.13.v20130916
[Thread-3] INFO org.eclipse.jetty.server.AbstractConnector - Started SelectChannelConnector@0.0.0.0:9090
[2015-07-29 10:11:30.926] - 5 - this-systems-instance-name-here - ExchageHandler/handle - /banner-sample.html
[2015-07-29 10:11:31.068] - 5 - this-systems-instance-name-here - ExchageHandler/handle - /js/privatex.js
[2015-07-29 10:11:31.156] - 5 - this-systems-instance-name-here - ExchageHandler/handle - /favicon.ico
[2015-07-29 10:11:31.247] - 5 - this-systems-instance-name-here - ExchageHandler/handle - /auction
[2015-07-29 10:11:31.366] - 5 - this-systems-instance-name-here - Auction/requestBids:waiting - Waiting for response from subscribers
[2015-07-29 10:11:31.411] - 5 - this-systems-instance-name-here - Subscriber:the-name:doRequest:sending - http://localhost:8080/rtb/bids/nexage ### {
  "id": "08c3189a-7cf6-48be-8fe4-95a89e38d2f7",
  "at": 2,
  "imp": [
    {
      "id": "08c3189a-7cf6-48be-8fe4-95a89e38d2f7",
      "instl": 0,
      "banner": {
        "pos": 0,
        "w": 320,
        "h": 50,
        "api": 0
      },
      "ext": {
        "rtb4free": {}
      }
    }
  ],
  "site": {
    "id": "publisher-id",
    "name": "Really Big Corp.",
    "domain": "junk1.com",
    "cat": [
      "IAB1",
      "IAB2"
    ],
    "publisher": {
      "id": "publisher-id",
      "name": "Really Big Corp."
    },
    "ext": {
      "rtb4free": {
        "connectionType": "unk",
        "platform": "Linux x86_64",
        "maxDownLink": -1.0
      }
    }
  },
  "device": {
    "ua": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/44.0.2403.89 Safari/537.36",
    "connectionType": 0,
    "devicetype": 0,
    "geo": {
      "lat": 33.8409696,
      "lon": -118.3520389,
      "country": "USA"
    }
  },
  "user": {
    "yob": 0,
    "geo": {
      "country": "USA",
      "type": 0
    },
    "ext": {
      "rtb4free": {}
    }
  }
}
[2015-07-29 10:11:31.701] - 5 - this-systems-instance-name-here - Subscriber:the-name:doRequest:response - Good bid received from Subscriber:the-name
[2015-07-29 10:11:31.873] - 5 - this-systems-instance-name-here - Auction/requestBids:complete - Number of bids: 1
MAP: {
  "seatbid": [
    {
      "seat": "99999999",
      "bid": [
        {
          "impid": "23skiddoo",
          "id": "08c3189a-7cf6-48be-8fe4-95a89e38d2f7",
          "price": 5.0,
          "adid": "ben:payday",
          "nurl": "http://localhost:8080/rtb/win/nexage/5.0/33.8409696/-118.3520389/ben:payday/08c3189a-7cf6-48be-8fe4-95a89e38d2f7/http%3A%2F%2Flocalhost%3A8080%2Fforward%3Fpublisher-id/http%3A%2F%2Flocalhost%3A8080%2Fimages%2F320x50.jpg%3Fadid%3Dben:payday%26%2338%3Bbidid%3D08c3189a-7cf6-48be-8fe4-95a89e38d2f7",
          "cid": "ben:payday",
          "crid": "23skiddoo",
          "iurl": "http://localhost:8080/images/320x50.jpg?adid=ben:payday&#38;bidid=08c3189a-7cf6-48be-8fe4-95a89e38d2f7",
          "adomain": "originator.com",
          "adm": "<a href='http://localhost:8080/redirect/ben:payday/nexage/08c3189a-7cf6-48be-8fe4-95a89e38d2f7?url=http://localhost:8080/forward?publisher-id'><img src='http://localhost:8080/pixel/nexage/ben:payday/08c3189a-7cf6-48be-8fe4-95a89e38d2f7/${AUCTION_PRICE}/23skiddoo' height='1' width='1'></img><img src='http://localhost:8080/images/320x50.jpg?adid=ben:payday&#38;bidid=08c3189a-7cf6-48be-8fe4-95a89e38d2f7' height='50.0' width='320.0'></img></a>"
        }
      ]
    }
  ],
  "id": "08c3189a-7cf6-48be-8fe4-95a89e38d2f7",
  "bidid": "08c3189a-7cf6-48be-8fe4-95a89e38d2f7"
}
</code>
</pre>
</div>
</div>     
                
                
                
                <p>If you want to run the private exchange in the background issue a nohup to start the program, like so:
                </p>
                <pre>
     $nohup ant > /dev/null &
                </pre>
                <a id="ANATOMY" name="ANATOMY-BANNER"></a>
                <h1>ANATOMY OF A BANNER AD</h1>

                <p>In this section we will put all of the pieces together for the banner ad demonstration web-page.</p>
                <h2>The Web Page With Ad Space for Sale</h2>
                <p>You load this page  <a href="sample" target="_blank">htpp://www.rtb4free.com/privatex/banner-sample.html</a> into your mobile phone's web browser; this will cause the online auction to happen.</p>
                <p>The HTML contents of the web page you are loading can be seen 
                
                <a href=
                "javascript:toggle('togglePage');" id=
                "displayText">here.</a></p>

                <div onclick="javascript:toggle('togglePage');">
                    <div id="togglePage" style=
                    "display:none; border-width:2px; border-style:solid">
<xmp>
<!DOCTYPE html>
<html>
<head>
    <title>Banner-Ad</title>
    <script src=
    "https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="js/privatex.js"></script>
</head>

<body>
    Blah blah blah blah The banner ad will appear below...

    <div id="the-ad-goes-here"></div>
    
    If there was a successful auction, the
    banner is right above us here...<br>
    Blah blah blah blah blah! 

<script>

/*
 * A function that handles no bids
 */
    function doNobid() {
    	alert("The RTB bidder returned no bid!");
    }

/*
 * Set up the parameters for the RTB auction
 */
    params = {};
    params.div = document.getElementById("the-ad-goes-here");
    params.exchangeid = "111-222-333-444-555";
    params.campaign = "banner-campaign";
    params.url = "http://localhost:9090/auction";
    params.nobid = doNobid;
    
/*
 * Do the auction!
 */
    ad = new PrivateRTB(params).perform();

</script> 
</body>
</html>
</xmp>
</div>
</div>

<p>As you can see above, ajax is loaded, and also privatex.js is loaded; this is the secret sauce. When the page
loads in the browser, a JavaScript object <i>PrivateRTB</i> is created. The PrivateRTB auction object uses a paremeter object
to define the particulars of the advertisement. In the Javascript above, this is the <i>params</i> object.</p>
The params.div attribute identifes the DIV where the banner ad is displayed. The web-campaign of the publisher is identified using
the params.campaign parameter. The params.exchangeid parameter defines the publisher's account on the private exchange. The
auction url is defined with params.url. The optional params.nobid parameter is a callback function in case you want to be
notified there was a no bid from the auction.</p>
<p>On the page load PrivateRTB object is created and the perform function is called. The perform causes an AJAX call to the private exchange 
to initiate the processes required to receive the HTML from a winning bid after auction. If Private Exchange found an ad, then the
The PrivateRTB auction object will change the innerHTML of the "the-ad-goes-here" DIV object  with the winning
advertisement's HTML</p>
<p>As you can see here we aren't doing any authentication in this example. In a real system authentication would be required, but 
for demo purposes it just gets in the way and so is not shown.</p>


<h2>Steps in the Process</h2>
<p>The following is the sequence of steps to place the auction for the web page when the user loads the
web page</p>
  <a href=
                "javascript:toggle('toggleRequestAuction');" id=
                "displayText">1 - Request the auction</a></p>

                <div onclick="javascript:toggle('toggleRequestAuction');">
                    <div id="toggleRequestAuction" style=
                    "display:none; border-width:2px; border-style:solid">
Auction goes here
 </div>
 </div>
 
  <a href=
                "javascript:toggle('toggleBidRequest');" id=
                "displayText">2 - Send Bid Requests</a></p>

                <div onclick="javascript:toggle('toggleBidResponset');">
                    <div id="toggleBidRequest" style=
                    "display:none; border-width:2px; border-style:solid">
Bid Request goes here
 </div>
 </div>
 
   <a href=
                "javascript:toggle('toggleBidResponse');" id=
                "displayText">3 - Receive Bid Response</a></p>

                <div onclick="javascript:toggle('toggleBidResponse');">
                    <div id="toggleBidResponse" style=
                    "display:none; border-width:2px; border-style:solid">
Bid response goes here
 </div>
 </div>
 
    <a href=
                "javascript:toggle('toggleAuction');" id=
                "displayText">4 - Auction</a></p>

                <div onclick="javascript:toggle('toggleAuction');">
                    <div id="toggleAuction" style=
                    "display:none; border-width:2px; border-style:solid">
Auction
 </div>
 </div>
 
     <a href=
                "javascript:toggle('toggleNotifyWinner');" id=
                "displayText">5 - Notify Winner</a></p>

                <div onclick="javascript:toggle('toggleNotifyWinner');">
                    <div id="toggleNotifyWinner" style=
                    "display:none; border-width:2px; border-style:solid">
Notify Winner
 </div>
 </div>
 
      <a href=
                "javascript:toggle('toggleServe');" id=
                "displayText">6 - Serve the Ad</a></p>

                <div onclick="javascript:toggle('toggleServe');">
                    <div id="toggleServe" style=
                    "display:none; border-width:2px; border-style:solid">
Serve ad
 </div>
 </div>
 
       <a href=
                "javascript:toggle('toggleAccounting');" id=
                "displayText">7 - Final Accounting</a></p>

                <div onclick="javascript:toggle('toggleAccounting');">
                    <div id="toggleAccounting" style=
                    "display:none; border-width:2px; border-style:solid">
Final Accounting
 </div>
 </div>
 
           <a id="ANATOMY" name="ANATOMY-VIDEO"></a>
                <h1>ANATOMY OF A VIDEO AD</h1>

                <p>In this section we will put all of the pieces together for the video ad demonstration web-page.</p>
                <h2>The Web Page With Ad Space for Sale</h2>
                <p>You load this page  <a href="sample" target="_blank">htpp://www.rtb4free.com/privatex/video-sample.html</a> into your mobile phone's web browser; this will cause the online auction to happen.</p>
                <p>The HTML contents of the web page you are loading can be seen 
                
                <a href=
                "javascript:toggle('togglePageVideo');" id=
                "displayText">here.</a></p>

                <div onclick="javascript:toggle('togglePageVideo');">
                    <div id="togglePageVideo" style=
                    "display:none; border-width:2px; border-style:solid">
<xmp>
<!DOCTYPE html>
<html>
<head>

    <script src=
    "https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="js/privatex.js"></script>
    <link href="http://vjs.zencdn.net/4.7.1/video-js.css" rel="stylesheet">
    <link href="vplayer/lib/videojs-contrib-ads/videojs.ads.css" rel=
    "stylesheet" type="text/css">
    <link href="vplayer/videojs.vast.css" rel="stylesheet" type="text/css">
    <style type="text/css">
.description {
      background-color:#eee;
      border: 1px solid #777;
      padding: 10px;
      font-size: .8em;
      line-height: 1.5em;
      font-family: Verdana, sans-serif;
    }
    .example-video-container {
      display: inline-block;
    }
    </style><!--[if lt IE 9]><script src="lib/es5.js"></script><![endif]-->

    <script src="http://vjs.zencdn.net/4.7.1/video.js"></script>
    <script src="vplayer/lib/videojs-contrib-ads/videojs.ads.js"></script>
    <script src="vplayer/lib/vast-client.js"></script>
    <script src="vplayer/videojs.vast.js"></script>

    <title></title>
</head>

<body>
    <p>In the space below, a video about animals of the oceans feeding. But
    first, the page will ask for an advertisement to appear in the video player
    below.</p>

    <p>If the RTB bidder returns an ad for 'Charmin' bath tissue then
    transaction succeeded. If the animals in the sea video plays first, then
    that means there was a no bid from the RTB bidder.</p>
    
    <video autoplay=""
    class='video-js vjs-default-skin' controls="" data-setup='{}' height='300'
    id='vid2' poster='http://video-js.zencoder.com/oceans-clip.png' preload=
    'auto' width='300'>
    <source src='http://video-js.zencoder.com/oceans-clip.mp4' type=
    'video/mp4'>
    <source src='http://video-js.zencoder.com/oceans-clip.webm' type=
    'video/webm'>
    <source src='http://video-js.zencoder.com/oceans-clip.ogv' type=
    'video/ogg'>
    <p>Video Playback Not Supported</p>
    </video><br/>

    <p>Blah blah blah, the web page continues</p>
    
<script>

/*
 * This function will be entered when the video ad is returned, the video
 * player will receive the VAST xml in this function
 */
    function onVideo(data) {
   		vid2 = videojs('vid2');
    	vid2.muted(false);
    	vid2.ads();
    	vid2.vast({
        	url:  'http://localhost:8080/vast/onion270.xml'
    	});
    }
 
/*
 * A function to handle no bids
 */   
    function onNoBid() {
    	console.log("No bid!");
    }

/*
 * Set up the parameters for the auction on this page
 */
    params = {};
    params.exchangeid = "111-222-333-444-555";
    params.campaign = "video-campaign";
    params.url = "http://localhost:9090/auction";
    params.nobid = onNoBid;
    params.video = onVideo;

/*
 * Do the auction as the page loads
 */
 
    ad = new PrivateRTB(params).perform();

</script> 
</body>
</html>
</xmp>
</div>
</div>
<p>To play video ads in this example we use Videojs with a VAST plugin. You can locate it here <a href="http://vastjs.com" target="_blank">here</a>.  
The VAST plugin is located <a href="https://github.com/theonion/videojs-vast-plugin" target="_blank">here.</a></p>
As you can see above, ajax is loaded, and also privatex.js is loaded; this is the secret sauce. When the page
loads in the browser, a JavaScript object <i>PrivateRTB</i> is created. The PrivateRTB auction object uses a paremeter object
to define the particulars of the advertisement. In the Javascript above, this is the <i>params</i> object.</p>
Unlike the banner ad, there is no params.div, instead, you use params.video to identify a JavaScript function that will
dynamically access the video player. The web-campaign of the publisher is identified using
the params.campaign parameter. The params.exchangeid parameter defines the publisher's account on the private exchange. The
auction url is defined with params.url. The optional params.nobid parameter is a callback function in case you want to be
notified there was a no bid from the auction.</p>
<p>On the page load PrivateRTB object is created and the perform function is called. The perform causes an AJAX call to the private exchange 
to initiate the processes required to receive the HTML from a winning bid after auction. If Private Exchange found an ad, then the
The PrivateRTB auction object calls your onVideo() function. The <i>data</i> parameter is a an object that contains a vast attribute 
which has the VAST XML, and optionally, a <i>url</i> object which defines the URL of the VAST if your player wants an http entry for
retrieving the VAST itself. XRTB and Private Exchange support sending this non-standard <i>url</i> attribute back as the player
we use cannot accept the raw VAST, but instead wants to load it itself.
advertisement's HTML</p>
<p>As you can see here we aren't doing any authentication in this example. In a real system authentication would be required, but 
for demo purposes it just gets in the way and so is not shown.</p>
</div>    
</div>

<h2>Steps in the Process</h2>
<p>The following is the sequence of steps to place the auction for the web page when the user loads the
web page</p>
  <a href=
                "javascript:toggle('toggleRequestAuction');" id=
                "displayText">1 - Request the auction</a></p>

                <div onclick="javascript:toggle('toggleRequestAuction');">
                    <div id="toggleRequestAuction" style=
                    "display:none; border-width:2px; border-style:solid">
Auction goes here
 </div>
 </div>
 
  <a href=
                "javascript:toggle('toggleBidRequest');" id=
                "displayText">2 - Send Bid Requests</a></p>

                <div onclick="javascript:toggle('toggleBidResponset');">
                    <div id="toggleBidRequest" style=
                    "display:none; border-width:2px; border-style:solid">
Bid Request goes here
 </div>
 </div>
 
   <a href=
                "javascript:toggle('toggleBidResponse');" id=
                "displayText">3 - Receive Bid Response</a></p>

                <div onclick="javascript:toggle('toggleBidResponse');">
                    <div id="toggleBidResponse" style=
                    "display:none; border-width:2px; border-style:solid">
Bid response goes here
 </div>
 </div>
 
    <a href=
                "javascript:toggle('toggleAuction');" id=
                "displayText">4 - Auction</a></p>

                <div onclick="javascript:toggle('toggleAuction');">
                    <div id="toggleAuction" style=
                    "display:none; border-width:2px; border-style:solid">
Auction
 </div>
 </div>
 
     <a href=
                "javascript:toggle('toggleNotifyWinner');" id=
                "displayText">5 - Notify Winner</a></p>

                <div onclick="javascript:toggle('toggleNotifyWinner');">
                    <div id="toggleNotifyWinner" style=
                    "display:none; border-width:2px; border-style:solid">
Notify Winner
 </div>
 </div>
 
      <a href=
                "javascript:toggle('toggleServe');" id=
                "displayText">6 - Serve the Ad</a></p>

                <div onclick="javascript:toggle('toggleServe');">
                    <div id="toggleServe" style=
                    "display:none; border-width:2px; border-style:solid">
Serve ad
 </div>
 </div>
 
       <a href=
                "javascript:toggle('toggleAccounting');" id=
                "displayText">7 - Final Accounting</a></p>

                <div onclick="javascript:toggle('toggleAccounting');">
                    <div id="toggleAccounting" style=
                    "display:none; border-width:2px; border-style:solid">
Final Accounting
 </div>
 </div>
 
 
 
 
     			<a id="THEORY" name="THEORY"></a>
                <h1>THEORY</h1>
 
      			<a id="DEPENDENCIES" name="DEPENDENCIES"></a>
                <h1>DEPENDENCIES</h1>
 
        </div>
    </div><br>
    <br>

    <footer>
        <p>&copy; Ben M. Faul, Peter Loh, RTB4FREE.ORG 2015</p>
        <p>Email: Ben.Faul@gmail.com</p>
    </footer><br>
    <script type="text/javascript">

    function toggle(elementId) {
    var ele = document.getElementById(elementId);
    if(ele.style.display == "block") {
            ele.style.display = "none";
    }
    else {
        ele.style.display = "block";
    }
    } 

    </script> <!-- Bootstrap core JavaScript
    ================================================== -->
     <!-- Placed at the end of the document so the pages load faster -->
     <script src=
    "https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script> <script src="../../dist/js/bootstrap.min.js"></script> <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
     <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script> <script src="offcanvas.js"></script>
</body>
</html>